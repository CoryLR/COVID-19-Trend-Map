<div class="trend-map-container">

  <div class="header">
    <h3>COVID-19 Trend Map</h3>
    <h5> BETA 2 // WORK IN PROGRESS</h5>
  </div>

  <div class="map-wrapper">
    <div id="map"></div>
  </div>

  <div class="info-panel" [@panelOpenClosed]="infoPanelOpen ? 'open' : 'closed'">

    <div class="close-panel" (click)="closePanel()">x</div>

    <div><em>Status Report for:</em></div>
    <h4>{{panelContent.title}}</h4> <!-- County or State -->
    <h6>{{panelContent.subtitle}}</h6> <!-- State or blank -->
    <p *ngIf="weekDefinitions"><em>{{weekDefinitions.list[latestTimeStop.num] + 20}} (Latest)</em></p>
    <!-- <p>{{panelContent.date}}20</p> -->

    <p innerHTML="{{panelContent.summary}}"></p>

    <div class="chart-title">New Cases Per Week</div>
    <div *ngIf="statusReportChartConfig.lineChartData">
      <canvas baseChart height="200" class="stat-chart"
          [datasets]="statusReportChartConfig.lineChartData" 
          [labels]="statusReportChartConfig.lineChartLabels" 
          [options]="statusReportChartConfig.lineChartOptions"
          [colors]="statusReportChartConfig.lineChartColors" 
          [legend]="statusReportChartConfig.lineChartLegend" 
          [chartType]="statusReportChartConfig.lineChartType" 
          [plugins]="statusReportChartConfig.lineChartPlugins"
          >
        </canvas>
    </div>

    <div *ngIf="initialLoadDone" class="panel-stats-section">
      <div class="stat-title">New Cases This Week</div>&nbsp;&nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="1-Week COVID-19 Case Rate"
        ngbPopover="Number of new COVID-19 cases from {{weekDefinitions.list[currentTimeStop.num-1]}} to {{weekDefinitions.list[currentTimeStop.num]}}"
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.rate}}</span> ({{panelContent.rateNorm}} per 100k)</div>
      <div class="stat-title">Acceleration</div> (2 Weeks) &nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="2-Week COVID-19 Case Acceleration"
        ngbPopover="The number of more new cases this week compared to the previous week, i.e. the difference in weekly rate from {{weekDefinitions.list[currentTimeStop.num-2]}} to {{weekDefinitions.list[currentTimeStop.num]}}. Note: negative acceleration is deceleration."
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.acceleration}}</span> ({{panelContent.accelerationNorm}} per 100k)</div>
      <div class="stat-title">Cumulative</div> &nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="Cumulative COVID-19 Case Count"
        ngbPopover="Total count of confirmed COVID-19 cases since the beginning"
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.cumulative}}</span></div>
    </div>

    <br>
    <br>

    <div class="form-group">
      <label for="exampleInputEmail1">Share link to this status report:</label>
      <input readonly class="form-control status-report-link-text"
      value="{{window.location.origin}}?fips={{panelContent.fips}}">
    </div>
    <button (click)="copyText(window.location.origin + '?fips=' + panelContent.fips)" class="btn btn-secondary">Copy</button>
    &nbsp;
    <a href="{{window.location.origin}}?fips={{panelContent.fips}}" target="_blank"><button class="btn btn-secondary">Open (New Tab)</button></a>
    
  </div>

  <div *ngIf="currentTimeStop && currentTimeStop.num != undefined && weekDefinitions.list" class="temporal-box">
    <!-- <button class="btn btn-secondary">Copy</button>
    <button class="btn btn-secondary">Copy</button> -->
    <div class="animation-play-pause-button-wrapper">
      <fa-icon *ngIf="animationPaused" (click)="playAnimation()" [icon]="faPlay"></fa-icon>
      <fa-icon *ngIf="!animationPaused" (click)="pauseAnimation()" [icon]="faPause"></fa-icon>
    </div>
    <div *ngIf="currentTimeStop && currentTimeStop.num != undefined" class="time-slider-wrapper">
      <input [(ngModel)]="currentTimeStop.num" (ngModelChange)="timeSliderChange(currentTimeStop.num)" type="range" class="custom-range time-slider" min="0" max="{{weekDefinitions.list.length - 1}}" id="customRange2">
    </div>
    <div class="animation-date">
      {{weekDefinitions.list[currentTimeStop.num].slice(0, -3)}}
    </div>

  </div>

  <!-- <div class="placeholder-box" style="z-index: 1000; position: absolute; left: 30%; bottom: 20px; width: 40%; height: 60px;">
    <div>Placeholder: Historical Data & Animation Controls</div>
  </div> -->

  <!-- <div class="placeholder-box" style="z-index: 1000; position: absolute; right: 20px; bottom: 20px; width: 240px; height: 180px;">
    <div>Placeholder: Legend
      <br>
      <br> COVID-19 Cases 
      <br> Red = Acceleration
      <br> Blue = Deceleration
    </div>
  </div> -->
  
  <div *ngIf="weekDefinitions && legendColorSchemeData" class="map-legend">
    <h5>Map Legend</h5> &nbsp;&nbsp; <span 
      ngbPopover="Current map data is for {{weekDefinitions.list[currentTimeStop.num - 1] ? weekDefinitions.list[currentTimeStop.num - 1] + '20 to ' : ''}}{{weekDefinitions.list[currentTimeStop.num] + 20}}"
      triggers="mouseenter:mouseleave"
      container="body"
      class="legend-date">{{weekDefinitions.list[currentTimeStop.num].slice(0, -3)}}</span>
    <p
      ngbPopover="Number of new COVID-19 Cases for {{weekDefinitions.list[currentTimeStop.num - 1] ? weekDefinitions.list[currentTimeStop.num - 1] + '20 to ' : ''}}{{weekDefinitions.list[currentTimeStop.num]}} per 100,000 people"
      triggers="mouseenter:mouseleave"
      container="body"
    >New COVID-19 Cases <br>(Weekly per 100k)</p>
    <div class="color-scheme">
      <div *ngFor="let item of legendColorSchemeData" class="color-set">
        <div [ngStyle]="mapZoomedIn ? {'background-color': item.colorFaded} : {'background-color': item.color}" class="box"></div>{{item.label}}
      </div>
    </div>

  </div>


</div>
