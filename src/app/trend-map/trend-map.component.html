<div class="trend-map-container">

  <div class="header">
    <img class="logo" src="assets/img/covid-watch-compass-128px.png">
    <h3>COVID-19-Watch</h3>
    <!-- <h5> BETA 3 // WORK IN PROGRESS</h5> -->
  </div>

  <!-- this element gets initialized here and moved on initial load -->
  <div *ngIf="windowWidth" class="search-text">
    <fa-icon [icon]="faSearch"></fa-icon>
    {{windowWidth > 384 ? "Find a Status Report" : "Status Reports"}}
  </div>

  <div *ngIf="!initialLoadingDone" [@ngIfAnimation] class="loading-splash">
    <p class="loading-text">Loading...</p>
    <img src="assets/img/covid-watch-256px.png">
  </div>

  <div class="map-wrapper">
    <div id="map"></div>
  </div>

  <div class="info-panel" *ngIf="panelContent && currentTimeStop" [@panelOpenClosed]="infoPanelOpen ? 'open' : 'closed'">

    <div class="close-panel-background" (click)="closePanel()" *ngIf="infoPanelCloseButton"><fa-icon [icon]="faCircle"></fa-icon></div>
    <div class="close-panel" (click)="closePanel()" *ngIf="infoPanelCloseButton"><fa-icon [icon]="faTimesCircle"></fa-icon></div>

    <div><em>{{currentTimeStop.num === latestTimeStop.num ? '' : 'Historic '}}Status Report for:</em></div>
    <h3>{{panelContent.title}}</h3> <!-- County or State -->
    <h6>{{panelContent.subtitle}}</h6> <!-- State or blank -->
    <p *ngIf="weekDefinitions"><em>{{weekDefinitions.list[currentTimeStop.num] + 20}} {{currentTimeStop.num === latestTimeStop.num ? '(Latest)' : ''}}</em></p>
    <!-- <p>{{panelContent.date}}20</p> -->

    <p innerHTML="{{panelContent.summary}}"></p>

    <div class="chart-title">New Cases Per Week</div>
    <div *ngIf="statusReportChartConfig.lineChartData">
      <canvas baseChart height="200" class="stat-chart"
          [datasets]="statusReportChartConfig.lineChartData" 
          [labels]="statusReportChartConfig.lineChartLabels" 
          [options]="statusReportChartConfig.lineChartOptions"
          [colors]="statusReportChartConfig.lineChartColors" 
          [legend]="statusReportChartConfig.lineChartLegend" 
          [chartType]="statusReportChartConfig.lineChartType" 
          [plugins]="statusReportChartConfig.lineChartPlugins"
          >
        </canvas>
    </div>

    <div *ngIf="initialLoadingDone" class="panel-stats-section">
      <div class="stat-title">New Cases This Week</div>&nbsp;&nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="1-Week COVID-19 Case Rate"
        ngbPopover="Number of new COVID-19 cases from {{weekDefinitions.list[currentTimeStop.num-1]}} to {{weekDefinitions.list[currentTimeStop.num]}}"
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.rate}}</span> ({{panelContent.rateNorm}} per 100k)</div>
      <div class="stat-title">Acceleration</div> (2 Weeks) &nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="2-Week COVID-19 Case Acceleration"
        ngbPopover="The number of more new cases this week compared to 2 weeks ago. Specifically, the difference in weekly rate between the weeks of {{weekDefinitions.list[currentTimeStop.num-2]}} and {{weekDefinitions.list[currentTimeStop.num]}}. Note: negative acceleration is deceleration."
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.acceleration}}</span> ({{panelContent.accelerationNorm}} per 100k)</div>
      <div class="stat-title">Cumulative</div> &nbsp;<fa-icon
        [icon]="faInfoCircle"
        popoverTitle="Cumulative COVID-19 Case Count"
        ngbPopover="Total count of confirmed COVID-19 cases since the beginning"
        triggers="mouseenter:mouseleave"
        placement="right"
        container="body"
        ></fa-icon>
      <div><span class="primary-stat">{{panelContent.cumulative}}</span></div>
    </div>

    <br>
    <br>

    <div class="form-group">
      <label for="exampleInputEmail1">Share link to this status report:</label>
      <input readonly class="form-control status-report-link-text"
      value="{{window.location.origin}}?fips={{panelContent.fips}}&name={{replaceSpaces(panelContent.title, '+')}}">
    </div>
    <button (click)="copyText(window.location.origin + '?fips=' + panelContent.fips + '&name=' + replaceSpaces(panelContent.title, '+'))" class="btn btn-secondary">Copy</button>
    &nbsp;
    <a href="{{window.location.origin}}?fips={{panelContent.fips}}&name={{replaceSpaces(panelContent.title, '+')}}" target="_blank"><button class="btn btn-secondary">Open (New Tab)</button></a>
    
  </div>

  <!-- <div class="placeholder-box" style="z-index: 1000; position: absolute; left: 30%; bottom: 20px; width: 40%; height: 60px;">
    <div>Placeholder: Historical Data & Animation Controls</div>
  </div> -->

  <!-- <div class="placeholder-box" style="z-index: 1000; position: absolute; right: 20px; bottom: 20px; width: 240px; height: 180px;">
    <div>Placeholder: Legend
      <br>
      <br> COVID-19 Cases 
      <br> Red = Acceleration
      <br> Blue = Deceleration
    </div>
  </div> -->
  
  <div *ngIf="weekDefinitions && legendColorSchemeData" class="map-legend">
    <h5>Map Legend</h5> &nbsp;&nbsp;
    <!-- <span 
      ngbPopover="Current map data is for the week ending in {{weekDefinitions.list[currentTimeStop.num] + 20}} {{weekDefinitions.list[currentTimeStop.num - 1] ? '(' + weekDefinitions.list[currentTimeStop.num - 1] + '20 through ' + weekDefinitions.list[currentTimeStop.num] + '20)' : ''}}"
      triggers="mouseenter:mouseleave"
      container="body"
      class="legend-date">{{weekDefinitions.list[currentTimeStop.num]}}20</span> -->

      <div class="btn-group layer-picker-wrapper">
        <div ngbDropdown container="body" class="layer-picker-part-dropdown">
          <button type="button" id="layer-picker" class="layer-picker layer-picker-button btn btn-secondary btn-sm btn-light" ngbDropdownToggle>
            {{layerSelection.alias}}
          </button>
          <div ngbDropdownMenu aria-labelledby="layer-picker">
            <a ngbDropdownItem class="dropdown-layer-label">Select a COVID-19 metric:</a>
            <a ngbDropdownItem (click)="changeLayerSelection('ccr')" class="dropdown-layer-option"><div class="fa-inline"><fa-icon [icon]="faPlusSquare"></fa-icon></div> County Case Rate</a>
            <a ngbDropdownItem (click)="changeLayerSelection('cca')" class="dropdown-layer-option"><div class="fa-inline"><fa-icon [icon]="faChartLine"></fa-icon></div> County Case Acceleration</a>
            <!-- <a ngbDropdownItem (click)="changeLayerSelection('cdr')" class="dropdown-layer-option">County Death Rate</a> -->
            <!-- <a disabled ngbDropdownItem (click)="changeLayerSelection('cr')" class="disabled dropdown-layer-option">County Recovery</a> -->
            <!-- <a disabled ngbDropdownItem (click)="changeLayerSelection('scr')" class="disabled dropdown-layer-option">State Case Rate</a> -->
            <!-- <a disabled ngbDropdownItem (click)="changeLayerSelection('sca')" class="disabled dropdown-layer-option">State Case Acceleration</a> -->
            <!-- <a ngbDropdownItem (click)="changeLayerSelection('sdr')" class="dropdown-layer-option">State Death Rate</a> -->
          </div>
        </div>    
        <button type="button"
        class="layer-picker-part-collapse layer-picker-button btn btn-secondary btn-sm btn-light"
        (click)="legendLayerInfoOpen = !legendLayerInfoOpen"
        title="{{legendLayerInfoOpen ? 'Collapse layer info' : 'Show layer info'}}">
        <span class="layer-picker-fa-icon">
          <fa-icon *ngIf="legendLayerInfoOpen" [icon]="faArrowDown"></fa-icon>
          <fa-icon *ngIf="!legendLayerInfoOpen" [icon]="faInfo"></fa-icon>
        </span>
        </button>
      </div>

    <!-- ngbPopover="Number of new COVID-19 Cases for {{weekDefinitions.list[currentTimeStop.num - 1] ? weekDefinitions.list[currentTimeStop.num - 1] + '20 to ' : ''}}{{weekDefinitions.list[currentTimeStop.num]}} per 100,000 people"
    triggers="mouseenter:mouseleave"
    container="body" -->
    <div class="layer-info" *ngIf="legendLayerInfoOpen"><!-- [@layerInfoCollapseAnimation] -->
      <div class="layer-color-scheme">
        <div *ngFor="let item of legendContent.colorSchemeData" class="color-set">
          <div [ngStyle]="mapZoomedIn ? {'background-color': item.colorFaded} : {'background-color': item.color}" class="box"></div>{{item.label}}
        </div>
      </div>
      <div class="layer-description">
        <p><strong>Description</strong><br>{{legendContent.layerDescription}}</p>
      </div>
    </div>

    <div *ngIf="currentTimeStop && currentTimeStop.num != undefined && weekDefinitions.list" class="temporal-box">
      <div class="animation-play-pause-button-wrapper">
        <fa-icon *ngIf="animationPaused" (click)="playAnimation()" [icon]="faPlay"></fa-icon>
        <fa-icon *ngIf="!animationPaused" (click)="pauseAnimation()" [icon]="faPause"></fa-icon>
      </div>
      <div *ngIf="currentTimeStop && currentTimeStop.num != undefined" class="time-slider-wrapper">
        <input [(ngModel)]="currentTimeStop.num" (ngModelChange)="timeSliderChange(currentTimeStop.num)" type="range" class="custom-range time-slider" min="0" max="{{weekDefinitions.list.length - 1}}" id="customRange2">
      </div>
      <div class="animation-date">
        {{weekDefinitions.list[currentTimeStop.num]}}
      </div>
    </div>
  </div>


</div>
